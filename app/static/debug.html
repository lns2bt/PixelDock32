<!doctype html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PixelDock32 • Debugging</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body data-page="debug" data-requires-auth="true">
  <header class="top-nav">
    <div class="top-nav-inner">
      <a class="brand" href="/">PixelDock32</a>
      <nav class="top-nav-links" aria-label="Hauptnavigation">
        <a data-page-link="overview" href="/">Overview</a>
        <a data-page-link="modules" href="/modules">Modules</a>
        <a data-page-link="debug" href="/debug">Debugging</a>
        <a data-page-link="tools" href="/tools">Preview & Tools</a>
        <a data-page-link="login" href="/login">Login</a>
      </nav>
      <div class="top-nav-actions">
        <button class="btn btn-secondary" onclick="refreshStatus()">Status aktualisieren</button>
        <button class="btn btn-secondary" id="logoutBtn" onclick="logout()">Logout</button>
      </div>
    </div>
  </header>

  <main class="app-shell">
    <section class="card section-anchor" data-section-title="Debugging">
      <h2>Hardware-Debug & Kalibrierung</h2>
      <p class="subtle">Schnellkorrektur in <code>.env</code>: <code>PANEL_ORDER=0,1,2,3</code> und <code>PANEL_ROTATIONS=0,0,0,0</code>.</p>
      <div class="form-row debug-row">
        <div class="field"><label for="debugPattern">Pattern</label><select id="debugPattern"><option value="pixel_walk">Pixel Walk</option><option value="panel_walk">Panel Walk</option><option value="stripes">Stripes</option><option value="border">Border</option></select></div>
        <div class="field"><label for="debugSeconds">Laufzeit (Sekunden)</label><input id="debugSeconds" type="number" min="1" max="300" value="20" /></div>
        <div class="field"><label for="debugInterval">Intervall (ms)</label><input id="debugInterval" type="number" min="50" max="2000" value="250" /></div>
        <div class="field actions-end"><button class="btn" onclick="startDebugPattern()">Pattern starten</button></div>
        <div class="field actions-end"><button class="btn btn-secondary" onclick="stopDebugPattern()">Pattern stoppen</button></div>
      </div>
      <div class="preset-row">
        <button class="btn btn-secondary" onclick="runPreset('panel_walk', 20, 350)">Wiring Check</button>
        <button class="btn btn-secondary" onclick="runPreset('pixel_walk', 60, 120)">Serpentine Check</button>
        <button class="btn btn-secondary" onclick="runPreset('stripes', 20, 300)">Noise Check</button>
      </div>
      <div class="preset-row" style="margin-top:12px;">
        <button class="btn btn-secondary" onclick="refreshDhtDebug()">DHT Debug aktualisieren</button>
        <button class="btn" onclick="runDhtReadOnce()">DHT Read Once</button>
        <button class="btn btn-secondary" onclick="runGpioEnvironmentCheck()">GPIO-Umgebung prüfen</button>
      </div>
      <details class="debug-panel" open><summary>DHT Read-Once Ergebnis</summary><div id="dhtReadOnceResult" class="mapping-info" style="margin-top:8px;">Noch kein DHT Einzel-Read ausgeführt.</div></details>
      <details class="debug-panel" open><summary>DHT Debug (JSON)</summary><pre id="dhtDebugInfo" class="debug-pre">-</pre></details>
    </section>

    <section class="card section-anchor" data-section-title="Debugging">
      <h2>GPIO Pin Finder</h2>
      <div class="form-row gpio-row">
        <div class="field"><label for="gpioPin">GPIO (BCM)</label><input id="gpioPin" type="number" min="2" max="27" value="18" /></div>
        <div class="field"><label for="gpioPulses">LED-Test Pulse</label><input id="gpioPulses" type="number" min="1" max="12" value="3" /></div>
        <div class="field"><label for="gpioHoldMs">Pulse Dauer (ms)</label><input id="gpioHoldMs" type="number" min="80" max="2000" value="220" /></div>
        <div class="field actions-end"><button class="btn" onclick="runGpioOutputTest()">LED-Datenpin testen</button></div>
      </div>
      <div class="form-row gpio-row" style="margin-top:8px;">
        <div class="field"><label for="gpioSampleMs">Input-Probe Dauer (ms)</label><input id="gpioSampleMs" type="number" min="250" max="10000" value="1200" /></div>
        <div class="field"><label for="gpioPull">Input Pull</label><select id="gpioPull"><option value="up" selected>Pull-Up</option><option value="down">Pull-Down</option></select></div>
        <div class="field actions-end"><button class="btn btn-secondary" onclick="runGpioInputProbe()">Sensor-Pin prüfen</button></div>
      </div>
      <details class="debug-panel" open><summary>GPIO Debug-Ausgabe</summary><div id="gpioFinderResult" class="mapping-info">Noch kein GPIO-Test ausgeführt.</div></details>
    </section>

    <section class="card section-anchor" data-section-title="Debugging">
      <h2>Mapping-Wizard</h2>
      <div class="preset-row">
        <button class="btn btn-secondary" onclick="runPreset('panel_walk', 20, 350)">1) Panel-Reihenfolge prüfen</button>
        <button class="btn btn-secondary" onclick="runPreset('pixel_walk', 50, 120)">2) Serpentine prüfen</button>
        <button class="btn btn-secondary" onclick="runPreset('border', 20, 300)">3) Rand prüfen</button>
      </div>
      <div class="form-row wizard-row">
        <div class="field"><label for="mapX">Logisches X (0-31)</label><input id="mapX" type="number" min="0" max="31" value="0" /></div>
        <div class="field"><label for="mapY">Logisches Y (0-7)</label><input id="mapY" type="number" min="0" max="7" value="0" /></div>
        <div class="field actions-end"><button class="btn" onclick="checkMappingCoordinate()">Koordinate erklären</button></div>
      </div>
      <div id="mappingInfo" class="mapping-info">Noch keine Koordinate geprüft.</div>
    </section>
  </main>

  <div id="toast"></div>
  <script src="/static/app.js"></script>
</body>
</html>
